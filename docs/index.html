<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://tuxlab.org'>Check out our webpage</a></li>
            <li><a href='https://github.com/learnlinux'>View Our Source Code</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="tuxlab">TuxLab</h1>

<p>Welcome to Tuxlab! You can use our platform and APIs to create linux lessons and tutorials.</p>

<h1 id="tuxlab-api">Tuxlab API</h1>

<blockquote>
<p>you can import the Tuxlab API as you would any other node module</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">tux</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tuxlab'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">tuxlab</span><span class="p">.</span><span class="nx">env</span><span class="p">;</span>

<span class="c1">//env is defined as part of the tuxlab api,</span>
<span class="c1">// but is easier and cleaner to use as a separate variable</span>
</code></pre>

<blockquote>
<p>you can chain function calls just like promises</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">createVm</span><span class="p">(</span><span class="nx">opts1</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">createVm</span><span class="p">(</span><span class="nx">opts2</span><span class="p">))</span>

</code></pre>

<p>The Tuxlab API is based on Promise.js, all API functions return promises as explained below. Therefore, function calls can be chained as promises by the <code>.then</code> function call. Alternatively, you can use the promise-waterfall api and use function calls in a list with lambda functions.</p>

<h2 id="env-init-opts">env.init(opts)</h2>

<p>initializes the environment. This function creates the lab Virtual Machine, the virtual machine students connect to from their interface. All lessons should start with the env.init() call. 
<aside class="warning">
Lessons that are not initialized might result in unwanted behavior
</aside></p>

<p>The parameter opts is optional, the environment defaults to a simple alpine linux virtual machine if not otherwise specified. You can specify additional options as a json file as documented on <a href="https://github.com/learnlinux">our options page</a></p>

<h2 id="env-createvm-opts">env.createVm(opts)</h2>

<blockquote>
<p>to create a vm with as little options as possible
&ldquo;`javascript
var tux = require(&lsquo;tuxlab&rsquo;);
var env = tuxlab.env;</p>
</blockquote>

<p>var vmOpts = {dockerodeCreateOptions: {name: &quot;jonathan&rdquo;}};
env.init()
  .then(createVm(vmOpts));</p>

<p>/<em>notice how we initialize the environment before creating and additional virtual machine</em>/
&ldquo;`</p>

<blockquote>
<p>to create a vm with more options specified</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">vmOpts</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">dockerodeCreateOptions</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">,</span> <span class="na">Image</span><span class="p">:</span> <span class="s2">"ubuntu"</span><span class="p">},</span>
  <span class="na">dockerodeStartOptions</span><span class="p">:</span> <span class="p">{}}</span>

<span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">createVm</span><span class="p">(</span><span class="nx">vmOpts</span><span class="p">));</span>
</code></pre>

<p>Creates and starts a new virtual machine. This command is ideal for tasks where students are expected to interact with another environment. An example usage might be a simulated website-hacking scenario.
Additional virtual machines should be connected to the Lab VM by a network. See below for instructions on how to create and manage networks. </p>

<p>The opts parameter should be supplied as a json file of type
<code>{dockerodeCreateOptions:{},dockerodeStartOptions:{}}</code>
name must be specified under <code>dockerodeCreateOptions</code> all other options are optional. VMs default to an alpine linux environment. You can find our option specification document on <a href="https://github.com/learnlinux">our options page</a></p>

<aside class="notice">
The name of a Virtual Machine is how you access and run commands on the virtual machine. Make sure to choose distinct, explanatory names for your VMs.
</aside>

<h2 id="env-updatevm-vmname-opts">env.updateVm(vmName,opts)</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">vmOpts</span> <span class="o">=</span> <span class="p">{</span><span class="na">dockerodeCreateOptions</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">}};</span>
<span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">createVm</span><span class="p">(</span><span class="nx">vmOpts</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updateVm</span><span class="p">(</span><span class="s2">"jonathan"</span><span class="p">,{</span><span class="na">Image</span><span class="p">:</span> <span class="s2">"ubuntu"</span><span class="p">}));</span>

<span class="c1">//vm defaults to alpine linux and then is changed to ubuntu</span>
</code></pre>

<p>Updates a virtual machine with the given options. Useful when the instructor wants to change the behavior of a virtual machine after it was created. Example: running the same task on alpine linux, and then ubuntu.
<aside class="warning">
<code>vmName</code> should be the name of a virtual machine previously defined in the environment instance running
</aside></p>

<h2 id="env-removevm-vmname-opts">env.removeVm(vmName,opts)</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">vmOpts</span> <span class="o">=</span> <span class="p">{</span><span class="na">dockerodeCreateOptions</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">}};</span>
<span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">createVm</span><span class="p">(</span><span class="nx">vmOpts</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">removeVm</span><span class="p">(</span><span class="s2">"jonathan"</span><span class="p">));</span>

<span class="c1">//vm is created then deleted</span>
</code></pre>

<p>Removes a virtual machine. It is efficient to remove virtual machines with idle tasks once they are no longer needed as it saves resources -and money-.
<aside class="warning">
<code>vmName</code> should be the name of a virtual machine previously defined in the environment instance running
</aside></p>

<h2 id="env-shell-vmname-command-opts">env.shell(vmName,command,opts)</h2>

<blockquote>
<p>it is important to check for the output</p>
</blockquote>
<pre class="highlight javascript"><code>
<span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">shell</span><span class="p">(</span><span class="nx">labVm</span><span class="p">,</span><span class="s2">"echo hello-world"</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">sOut</span><span class="p">){</span> <span class="nx">assert</span><span class="p">(</span><span class="nx">sOut</span> <span class="o">===</span> <span class="s2">"hello-world"</span><span class="p">);</span> <span class="p">},</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">sOut</span><span class="p">,</span><span class="nx">sErr</span><span class="p">,</span><span class="nx">dErr</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sOut</span><span class="p">);</span>
                                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sErr</span><span class="p">);</span>
                                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dErr</span><span class="p">);</span>
         <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">createVm</span><span class="p">({</span><span class="na">dockerodeCreateOptions</span><span class="p">:{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">}}));</span>

<span class="c1">//notice how we can continue chaining after handling the output</span>

</code></pre>

<blockquote>
<p>it is, however, possible to forego output handling</p>
</blockquote>
<pre class="highlight javascript"><code>
<span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">shell</span><span class="p">(</span><span class="nx">labVm</span><span class="p">,</span><span class="s2">"echo hello-world"</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">createVm</span><span class="p">({</span><span class="na">dockerodeCreateOptions</span><span class="p">:{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">}}));</span>

</code></pre>

<p>Runs a given command on the virtual machine with the given name. To fully utilize <code>env.shell</code> a basic understanding of promises is helpful. A documentation and tutorial on promises can be found on <a href="https://this is the link">the promise.js webpage</a></p>

<p>After a command is executed the promise is resolved with the stdout output, <code>resolve(sOut)</code> or rejected with the stdout, stderr and docker error messages, <code>reject(sOut,sErr,dockerErr)</code></p>

<aside class="notice">
env.shell will run if the output is not handled, but this is necessary to verify the command ran as planned
</aside>

<h2 id="tuxlab-createtask-setupfn-verifyfn-opts">tuxlab.createTask(setupFn, verifyFn, opts)</h2>

<blockquote>
<p>an example might be an mkdir task, asking students to create the folder &quot;derek&rdquo; in the root directory</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">env</span><span class="p">){</span>
  <span class="nx">env</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>  <span class="c1">//env.start is required if env.init is not called</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">shell</span><span class="p">(</span><span class="s2">"labVm"</span><span class="p">,</span><span class="s2">"cd ~./"</span><span class="p">));</span> <span class="c1">//go to root directory</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">verify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">env</span><span class="p">){</span>
  <span class="nx">env</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">shell</span><span class="p">(</span><span class="s2">"labVm"</span><span class="p">,</span><span class="s2">"ls ~./"</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">sOut</span><span class="p">){</span> <span class="k">if</span><span class="p">(</span><span class="nx">sOut</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"derek)&gt;-1) return "</span><span class="nx">success</span><span class="s2">";
              else { throw "</span><span class="nx">error</span><span class="err">:</span> <span class="nx">no</span> <span class="nx">folder</span> <span class="nx">named</span> <span class="nx">derek</span><span class="err">"</span> <span class="p">};},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">sOut</span><span class="p">,</span><span class="nx">sErr</span><span class="p">,</span><span class="nx">SDock</span><span class="p">){</span> <span class="k">throw</span> <span class="nx">sOut</span> <span class="o">+</span> <span class="nx">sErr</span> <span class="o">+</span> <span class="nx">sDock</span><span class="p">;</span> <span class="p">});</span>  
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">mkdirTask</span> <span class="o">=</span> <span class="nx">tuxlab</span><span class="p">.</span><span class="nx">createTask</span><span class="p">(</span><span class="nx">setup</span><span class="p">,</span><span class="nx">verify</span><span class="p">);</span>
</code></pre>

<p>Tasks are what students follow during a lab session. Each task consists of two lambda functions, setup and verify -both implemented using the env api- the setup function runs as soon as a student starts the task to prepare the environment. The verify function runs after the students clicks the &ldquo;verify&rdquo; button on the interface. </p>

<h2 id="tuxlab-init">tuxlab.init()</h2>

<p>Tuxlab.init is the initializer function of the tuxlab environment. This function MUST be called before task appends since it tells our api which task to start with.</p>

<h2 id="task-nexttask-ntask">task.nextTask(nTask)</h2>

<blockquote>
<p>lets say we have three tasks initialized as above, task1,task2,task3</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">tuxlab</span><span class="p">.</span><span class="nx">init</span><span class="p">().</span>
  <span class="p">.</span><span class="nx">nextTask</span><span class="p">(</span><span class="nx">task1</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">nextTask</span><span class="p">(</span><span class="nx">task2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">nextTask</span><span class="p">(</span><span class="nx">task3</span><span class="p">);</span>
</code></pre>

<p>nextTask is the function that tells our api to append tasks together. nextTask calls can be chained together much like .then calls. The example to the right shows how to specify that task1 will be run first, then task2 and finally task3.</p>

<h1 id="the-labfile">The LabFile</h1>

<blockquote>
<p>the import</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">myLab</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tuxlab'</span><span class="p">);</span>
</code></pre>

<blockquote>
<p>the setup function</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">myLab</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">env</span><span class="p">){</span> <span class="c1">//notice how we declare an env parameter</span>
  <span class="nx">env</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>  <span class="c1">//you MUST call env.init in the setup</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">createVm</span><span class="p">({</span><span class="na">cOpts</span><span class="p">:{</span><span class="na">name</span><span class="p">:</span> <span class="s2">"jonathan"</span><span class="p">}}));</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>the tasks function</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">myLab</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">env</span><span class="p">){</span> <span class="c1">//notice the env parameter</span>
  <span class="c1">//declare tasks here</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">().</span><span class="nx">nextTask</span><span class="p">(</span><span class="nx">task1</span><span class="p">).</span><span class="nx">nextTask</span><span class="p">(</span><span class="nx">task2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>the export</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">myLab</span><span class="p">;</span>
</code></pre>

<p>The LabFile is a blueprint of a lab that instructors create. It has four basic parts and utilizes the env and tuxlab APIs documented above. The LabFile imports and extends the tuxlab api.
All LabFiles MUST start with importing the tuxlab api in a variable of your choice. This variable is then extended with two functions: setup and tasks. Both setup and tasks functions take an env object as an input, allowing you to write your code without worrying about the infrastructure connection.
<aside class="notice">
If you do not specify an env parameter in both functions, your env modify functions will cause a compile time error
</aside></p>

<p>The Setup function runs as soon as a student logs in to an account. It is important to put as much as the setup as possible in the setup function to reduce loading times before and between tasks.
The tasks function runs just after setup and initializes the tasks the student will go through.
The export allows us to access the LabFile for each student and create their lab environment.
<aside class="warning">
A LabFile without an import, setup-tasks functions and an export will result in a syntax error
</aside></p>

          <h1 id="errors">Errors</h1>

<aside class="notice">This error section is stored in a separate file in `includes/_errors.md`. Slate allows you to optionally separate out your docs into many files&hellip;just save them to the `includes` folder and add them to the top of your `index.md`&rsquo;s frontmatter. Files are included in the order listed.</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request sucks</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The kitten requested is hidden for administrators only</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified kitten could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access a kitten with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The kitten requested has been removed from our servers</td>
</tr>
<tr>
<td>418</td>
<td>I&rsquo;m a teapot</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
